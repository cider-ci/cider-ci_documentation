<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content='IE=edge' http-equiv=X-UA-Compatible> <meta content='width=device-width, initial-scale=1' name=viewport> <title>Setup and Deployment - Cider-Ci Documentation</title> <link href="../../assets/stylesheets/app-b5c8715a.css" rel=stylesheet /> <script src="../../assets/javascripts/vendor-1e8b60d8.js"></script> <script src="../../assets/javascripts/app-871935e9.js"></script> </head> <body id=the-cider-ci-documentation> <div class=container> <nav class='navbar navbar-inverse'> <div class=container-fluid> <div class=navbar-header> <a class=navbar-brand href="../../">Cider-CI Documentation </a></div> <form action='/search.html' class='navbar-form navbar-left' id=search method=get role=search> <div class=form-group> <input class=form-control id=search-term name=term placeholder=Search> <button class='btn btn-default' style='display: none' type=submit>Submit</button> </div> </form> <ul class='nav navbar-nav'> <li> <a href="../../introduction/">Introduction </a></li> <li> <a href="../../introduction/quick-start/">Quick-Start </a></li> <li> <a href="../../sitemap.html">Sitemap </a></li> </ul> </div> </nav> <div class=row> <div class=col-md-6> <ol class=breadcrumb> <li> <a href="../../">Home </a></li> <li> <a href="../">Installation </a></li> <li> <a href="./">Setup and Deployment </a></li> </ol> </div> <div class=col-md-6> </div> </div> <div class=content> <h1 class=no_toc id=setup-and-deployment>Setup and Deployment</h1> <p>This page guides through the process of installing a customizable Cider-CI environment. If you are new to installing Cider-CI consider the <a href="/introduction/quick-start/">Quick Start Guide</a>.</p> <h3 class=no_toc id=table-of-contents>Table of Contents</h3> <ul id=markdown-toc> <li><a id=markdown-toc-introduction-and-prerequisites href="#introduction-and-prerequisites">Introduction and Prerequisites</a></li> <li><a id=markdown-toc-preparing-the-machines href="#preparing-the-machines">Preparing the Machines</a></li> <li><a id=markdown-toc-setting-up-an-inventory href="#setting-up-an-inventory">Setting up an Inventory</a></li> <li><a id=markdown-toc-running-the-deploy href="#running-the-deploy">Running the Deploy</a></li> <li><a id=markdown-toc-signing-in-and-testing-the-installation href="#signing-in-and-testing-the-installation">Signing in and Testing the Installation</a></li> <li><a id=markdown-toc-upgrading-a-cider-ci-environment href="#upgrading-a-cider-ci-environment">Upgrading a Cider-CI Environment</a></li> <li><a id=markdown-toc-next-steps---where-to-go-from-here href="#next-steps---where-to-go-from-here">Next Steps - Where to go from here</a></li> </ul> <h2 id=introduction-and-prerequisites>Introduction and Prerequisites</h2> <div class=row> <div class=col-md-8> <p>A Cider-CI environment consists of <strong>one Cider-CI server</strong> and <strong>any number of Cider-CI executors</strong>. The technical requirements on the <strong>executor</strong> are a <strong><a href="https://en.wikipedia.org/wiki/Java_virtual_machine">Java Virtual Machine</a></strong> of version 8 or later and <strong><a href="https://git-scm.com/">Git</a></strong> of version 2.1 or later. The <strong>server</strong> requires additionally <strong><a href="https://www.postgresql.org/">PostgreSQL</a></strong> of version 9.4 or later. We recommend at least <strong>4GB of memory</strong> and at least <strong>two real CPU cores</strong> for the Cider-CI <strong>server</strong>. The requirements for Cider-CI executors depends largely on what it is used for. The <strong>Cider-CI executor process</strong> itself should have about <strong>250MB of memory</strong> available.</p> <p class=text-warning>It is possible to run both on the same machine but we don not recommend to do so. A <strong>single machine setup</strong> is possible and can be considered for smaller teams. Running one or even more executors on the same machine as the server can <strong>impact the performance</strong> and consequently the <strong>stability</strong> of the <strong>server</strong>.</p> <p>The executors in Cider-CI act fairly autonomous. They pull work from the sever, and then process it without further interaction from the server. One of the benefits is that the only required connection is HTTP or preferably HTTPS from the executors to the servers. This feature eliminates a lot of trouble within firewall regulated environments since HTTP/HTTPS is likely possible.</p> <p class=text-warning>It is feasible to install, configure and add a Cider-CI executor to an existing Cider-CI server manually. Setting up a Cider-CI server manually would be a time consuming and error prone challenge. We highly recommend to use the [Cider-CI Deploy Project] to set up the server.</p> <p>The [Cider-CI Deploy Project] enables fully <strong>automatized installation, configuration</strong> and <strong>upgrading</strong> of your environment. It supports the <em>Linux</em> based Ubuntu 16.04 "Xenial" or Debian 8 "Jessie" operating systems out of the box. The automated deploy requires <a href="http://docs.ansible.com/ansible/index.html">Ansible</a> of version 2.1 or later on the <a href="http://docs.ansible.com/ansible/intro_installation.html#control-machine-requirements">control machine</a>. We will discuss the set-up in the next section.</p> <p class=text-warning>We assume that we are operating on <em>stock installations</em> of <em>Debian Jessie</em> or <em>Ubuntu Xenial</em> for the reminder of this documentation. The procedure is <strong>well tested</strong> for <strong>unmodified systems</strong> installed from <strong>official releases</strong>.</p> </div> <div class=col-md-4> <p><img alt=Requirements src="server-and-executors-requirements-53c9b350.svg"/></p> </div> </div> <h2 id=preparing-the-machines>Preparing the Machines</h2> <div class=row> <div class=col-md-8> <p>Ansible is a comparatively simple deploy environment. There is no server component but there is a machine from which the deployment is carried out. This is called the <a href="http://docs.ansible.com/ansible/intro_installation.html#control-machine-requirements">control machine</a>. If you target a single machine setup it stands to reason to use this machine also as the Ansible control machine. We also frequently use the Cider-CI server machine as the control machine.</p> <p>In the general case the machines are distinct. During the deployment the control machine needs to access the target machines via the ssh protocol. All machines need access to the Internet via http(s) to download artifacts such as packages for the system and also the packaged Cider-CI server itself.</p> <p class=text-warning>We recommend to set up <a href="https://linuxconfig.org/passwordless-ssh">password-less ssh access</a> from the control machine to the root account of the target machines. If the deploy via Ansible seems to hang indefinitely assert that <code>ssh root@your-target-machine</code> works without problems.</p> <p>Every controlled target machine needs a Python installation to be accessible by Ansible. This can be easily installed for our target operating Systems <em>Ubuntu Xenial</em> or <em>Debian Jessie</em> from system packages:</p> <div class="language-bash highlighter-coderay"><div class=CodeRay> <div class=code><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>apt-get install -y python2.7
</pre></div> </div> </div> <p>The control machine needs Ansible 2.1 or later. You can read the <a href="http://docs.ansible.com/ansible/intro_installation.html">Ansible Installation</a> documentation how to install it for your operating system. If you are using <em>Ubuntu Xenial</em> you can proceed as follows:</p> <div class="language-bash highlighter-coderay"><div class=CodeRay> <div class=code><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>apt-get install -y python2.7 python2.7-dev python-pip git ruby libffi-dev
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>pip install -I --upgrade pip
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>pip install -I --upgrade paramiko==1.17.0 ansible==2.1.0.0
</pre></div> </div> </div> <p class=text-warning>This will install some libraries and binaries into <code>/usr/local</code>. The command diverges from the official <a href="http://docs.ansible.com/ansible/intro_installation.html">Ansible Installation</a> documentation slightly and circumvents some issues we encountered recently.</p> </div> <div class=col-md-4> <p><img alt="Ansible Requirements" src="ansible-requirements-e5013c7b.svg"/></p> </div> </div> <h2 id=setting-up-an-inventory>Setting up an Inventory</h2> <div class=row> <div class=col-md-6> <p>We will use an example environment of one <em>Ubuntu Xenial</em> machine "xenial-16" used as the server and one <em>Debian Jessie</em> machine "jessie-40" as an executor.</p> <p>We start out with in an new and empty directory. You can alternative start by cloning the Git project <a href="https://github.com/cider-ci/demo-inventory">Cider-CI Demo-Inventory</a>. We first create a <code>hosts</code> file with the following contents. You would replace the values of <code>ansible_host</code> with the IP or names of your machines.</p> </div> <div class=col-md-6> <div class="language-ini highlighter-coderay"><div class=CodeRay> <div class=code><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span># the hosts file
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>[cider-ci_hosts]
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>xenial-16 ansible_connection=ssh ansible_user=root ansible_host=192.168.0.16
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>jessie-40 ansible_connection=ssh ansible_user=root ansible_host=192.168.0.40
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>[cider-ci_server]
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>xenial-16
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>[cider-ci_executors]
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>jessie-40
</pre></div> </div> </div> </div> </div> <div class=row> <div class=col-md-6> <p>It is now time to connect our inventory the Cider-CI project. We clone it into our inventory directory. If you decide to mange you inventory with Git - which is highly recommended - you could and should mange the cider-ci folder as Git submodule.</p> </div> <div class=col-md-6> <div class="language-bash highlighter-coderay"><div class=CodeRay> <div class=code><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>git clone -b release https://github.com/cider-ci/cider-ci cider-ci
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>cd cider-ci
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>git submodule update --init --recursive deploy
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>cd ..
</pre></div> </div> </div> </div> </div> <div class=row> <div class=col-md-6> <p>The [Cider-CI Deploy Project] comes with a set of <strong>predefined configuration variables</strong>. We will it as a <strong>base configuration</strong>. We could copy the file but linking it has the advantage that new configuration variables introduced with an update of Cider-CI will be immediately available when we update the <code>cider-ci</code> project.</p> </div> <div class=col-md-6> <div class="language-bash highlighter-coderay"><div class=CodeRay> <div class=code><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>mkdir group_vars
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>cd group_vars
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>ln -s ../cider-ci/deploy/all.yml all.yml
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>cd ..
</pre></div> </div> </div> </div> </div> <div class=row> <div class=col-md-6> <p>We will for now just override one variable the <code>ci_server_external_hostname</code>. This one is needed so our executor <code>jessie-40</code> knows where to find its server <code>xenial-40</code>. We create the file <code>group_vars/cider-ci_hosts.yml</code> with the following contents.</p> </div> <div class=col-md-6> <div class="language-yaml highlighter-coderay"><div class=CodeRay> <div class=code><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#777"># the group_vars/cider-ci_hosts.yml file</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span><span style="color:#606">ci_server_external_hostname</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">192.168.0.16</span></span>
</pre></div> </div> </div> </div> </div> <p class=text-warning>It is very important to use the correct file names! We are using the <a href="http://docs.ansible.com/ansible/playbooks_variables.html#variable-precedence-where-should-i-put-a-variable">precedence rules of Ansible</a> here. The implicit <code>all.yml</code> group in the inventory has a lower precedence then the explicit <code>cider-ci_hosts</code> group as defined in our <code>hosts</code> file. If we do not use matching file names corresponding to groups or hosts the variables defined within will not be used!</p> <div class=row> <div class=col-md-6> <p>Will will now set up one more and last file: <code>data.yml</code>. This one can be used to <strong>mange users and repositories</strong> available in your Cider-CI instance. Both could also be set via the user-interface. But managing them via a configuration file is a much better solution with respect to configuration management and documentation. Using this file also solves the chicken-and-egg problem of needing an initial user to sign in via the user interface.</p> <p>The <code>data.yml</code> files allows <strong>templating</strong> via Ansible respectively <a href="http://jinja.pocoo.org/docs/dev/">Jinja2</a>. So <code>{{ci_master_secret}}</code> will be replaced by the actual value of the <code>ci_master_secret</code> variable.</p> </div> <div class=col-md-6> <div class="language-yaml highlighter-coderay"><div class=CodeRay> <div class=code><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#777"># the data.yml file</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span><span style="color:#606">managed_users</span>:
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>  <span style="color:#606">admin</span>:
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>    <span style="color:#606">update_attributes</span>:
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>      <span style="color:#606">is_admin</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>      <span style="color:#606">password</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'{{ci_master_secret}}'</span></span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span><span style="color:#606">managed_repositories</span>:
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>  <span style="color:#606"><span style="color:#404">'</span><span>https://github.com/cider-ci/cider-ci_demo-project-bash</span><span style="color:#404">'</span></span>:
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>    <span style="color:#606">update_attributes</span>:
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'Cider-CI Bash Demo Project'</span></span>
</pre></div> </div> </div> </div> </div> <h2 id=running-the-deploy>Running the Deploy</h2> <div class=row> <div class=col-md-6> <p>We will now perform the actual deploy. It must be started from within the [Cider-CI Deploy Project] by supplying our inventory <code>hosts</code> file.</p> </div> <div class=col-md-6> <div class="language-bash highlighter-coderay"><div class=CodeRay> <div class=code><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>cd cider-ci/deploy
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>ansible-playbook -i ../../hosts deploy_play.yml
</pre></div> </div> </div> </div> </div> <p>The deploy will take some time which largely depends on the connection speed to the Internet.</p> <h2 id=signing-in-and-testing-the-installation>Signing in and Testing the Installation</h2> <div class=row> <div class=col-md-6> <p>We can now open the user interface in the browser via <code>http://http://192.168.0.16</code> where the IP should be replaced by your IP or hostname respectively. We will be redirected to the welcome page.</p> <p>The password for the <code>admin</code> user can now be found in the <code>master_secret.txt</code> file in our inventory directory.</p> </div> <div class=col-md-6> <p><img alt="Welcome Page" class=with-border src="welcome-page-3e0634fd.png"/></p> </div> </div> <div class=row> <div class=col-md-6> <p>After signing in we follow the links <code>Administration</code> → <code>Excutors</code> where we should find the configured executor up and running.</p> <p>The status of the various services can be inspected by following the links <code>Administration</code> → <code>Server status</code>.</p> <p>We can finally run some job from the configured <a href="https://github.com/cider-ci/cider-ci_demo-project-bash">Cider-CI Bash Demo Project</a> in the same way es described in the <a href="/introduction/quick-start/">Quick Start Guide</a>.</p> </div> <div class=col-md-6> <p><img alt=Executors class=with-border src="executors-page-2b593c02.png"/></p> </div> </div> <h2 id=upgrading-a-cider-ci-environment>Upgrading a Cider-CI Environment</h2> <div class=row> <div class=col-md-6> <p>Upgrading your Cider-CI is fairly simple once you have set up an inventory directory. In our working example we would update the cider-ci project and then simply rerun the deploy again.</p> </div> <div class=col-md-6> <div class="language-bash highlighter-coderay"><div class=CodeRay> <div class=code><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>cd cider-ci
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>git pull
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>git submodules update
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>cd deploy
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>ansible-playbook -i ../../hosts deploy_play.yml
</pre></div> </div> </div> </div> </div> <p class=text-warning>Upgrading a Cider-CI Environment is possible if the minor version (see <a href="http://semver.org/">Semantic Versioning</a>) of Cider-CI has changed. Upgrading across major versions is not guaranteed to be possible.</p> <h2 id=next-steps---where-to-go-from-here>Next Steps - Where to go from here</h2> <p>The <a href="https://github.com/cider-ci/demo-inventory">Cider-CI Demo-Inventory</a> discussed here is a good but simplistic start. The <a href="https://github.com/cider-ci/zhdk-inventory">ZHdK Cider-CI Inventory</a> uses more advanced configuration features.</p> </div> <div class=row> <div class=col-md-12> <footer> <div class=pull-right> Cider-CI <span class=semantic-version><span class=major>4</span><span class=divider>.</span><span class=minor>1</span><span class=patch-pre-build><span class=divider>.</span><span class=patch>0</span><span class=divider>-</span><span class=pre>0.0</span></span></span> Documentation 2016-07-24 © Thomas Schank and contributors </div> </footer> </div> </div> </div> </body> </html>