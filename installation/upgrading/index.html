<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content='IE=edge' http-equiv=X-UA-Compatible> <meta content='width=device-width, initial-scale=1' name=viewport> <title>Upgrading and Updating - Cider-Ci Documentation</title> <link href="../../assets/stylesheets/app-30beb77e.css" rel=stylesheet /> <script src="../../assets/javascripts/vendor-ce938919.js"></script> <script src="../../assets/javascripts/app-72be183c.js"></script> </head> <body id=the-cider-ci-documentation> <div class=container> <nav class='navbar navbar-inverse'> <div class=container-fluid> <div class=navbar-header> <a class=navbar-brand href="../../">Cider-CI <span class=semantic-version><span class=major>3</span><span class=divider>.</span><span class=minor>8</span></span> Documentation </a></div> <form action='https://www.google.com/search' class='navbar-form navbar-left' method=get role=search> <div class=form-group> <input name=as_sitesearch type=hidden value='docs.cider-ci.info'> <input name=hl type=hidden value=en> <input class=form-control name=as_q placeholder=Search> <button class='btn btn-default' style='display: none' type=submit>Submit</button> </div> </form> <ul class='nav navbar-nav'> <li> <a href="../../introduction/">Introduction </a></li> <li> <a href="../../introduction/quick-start/">Quick-Start </a></li> <li> <a href="../../sitemap.html">Sitemap </a></li> </ul> </div> </nav> <div class=row> <div class=col-md-6> <ol class=breadcrumb> <li> <a href="../../">Home </a></li> <li> <a href="../">Installation </a></li> <li> <a href="./">Upgrading and Updating </a></li> </ol> </div> <div class=col-md-6> </div> </div> <div class=content> <h1 class=no_toc id=upgrading-and-updating>Upgrading and Updating</h1> <p>This is a guide to upgrade or update your Cider-CI environment.</p> <h3 class=no_toc id=table-of-contents>Table of Contents</h3> <ul id=markdown-toc> <li><a id=markdown-toc-general-strategy href="#general-strategy">General Strategy</a> <ul> <li><a id=markdown-toc-clean-slate-deployment href="#clean-slate-deployment">Clean Slate Deployment</a></li> </ul> </li> <li><a id=markdown-toc-adding-executors-updating-inventory-and-variables href="#adding-executors-updating-inventory-and-variables">Adding, Executors, Updating Inventory and Variables</a></li> <li><a id=markdown-toc-upgrading href="#upgrading">Upgrading</a> <ul> <li><a id=markdown-toc-target-version-considerations href="#target-version-considerations">Target Version Considerations</a></li> <li><a id=markdown-toc-deploy-to-staging-first href="#deploy-to-staging-first">Deploy to Staging First</a></li> <li><a id=markdown-toc-using-git-update-instead-of-clone href="#using-git-update-instead-of-clone">Using Git <code>update</code> instead of <code>clone</code></a></li> </ul> </li> </ul> <h2 id=general-strategy>General Strategy</h2> <p>Deploying an upgrade to a higher version of Cider-CI or just deploying and updated inventory is technically no different from performing an initial deploy as covered in the <a href="../setup-and-deploy/#deploy">deploy section</a> of the <a href="../setup-and-deploy/">Setup and Deploy Guide</a>.</p> <p>You probably do not want to set the administrator password and thus we invoke the following command from the <a href="https://github.com/cider-ci/cider-ci_deploy">Cider-CI Deploy Project</a> within the complete <a href="https://github.com/cider-ci/cider-ci">Cider-CI Master Project</a>.</p> <p><code>ANSIBLE_LOAD_CALLBACK_PLUGINS=1 DEPLOY_ROOT_DIR=`pwd` ansible-playbook -i PATH-TO-OUR-INVENTORY play_site.yml</code></p> <h3 id=clean-slate-deployment>Clean Slate Deployment</h3> <p>A clean slate deploy tries to remove all Cider-CI components before installing new ones. This involves also a restart of the target machine. Clean slated deploys are enforced by setting the <code>clean_slate</code> variable to true.</p> <p><code>ANSIBLE_LOAD_CALLBACK_PLUGINS=1 DEPLOY_ROOT_DIR=`pwd` ansible-playbook -i PATH-TO-OUR-INVENTORY play_site.yml -e 'clean_slate=true'</code></p> <h2 id=adding-executors-updating-inventory-and-variables>Adding, Executors, Updating Inventory and Variables</h2> <p>Adding new hosts or change variables is best performed by triggering a new deployment as described in the <a href="#general-strategy">General Strategy</a>.</p> <p><span class=text-warning> Removing executors from the inventory will not remove the internal registration of those.</span> They should be removed via the user interface: <code>Administration</code> → <code>Executors</code> → <code>Show more</code> → <code>Delete</code>.</p> <div class="alert alert-danger"> <p>New executors <strong>must be added properly</strong>, e.g. by updating the inventory and running a deploy. It does not suffice to just copy or clone executor machines.</p> </div> <h2 id=upgrading>Upgrading</h2> <p>We assume that all adjustments for our Cider-CI environment are kept in a inventory outside the cloned <a href="https://github.com/cider-ci/cider-ci">Cider-CI Master Project</a>. The most convenient way is then to start with a fresh clone of the desired version:</p> <p><code>git clone https://github.com/cider-ci/cider-ci.git -b TARGET-VERSION --recursive</code></p> <p>The <code>TARGET-VERSION</code> can be a version tag, such as <code>Cider-CI_3.7.0</code> or a branch name, or even the hash of a commit.</p> <p>After this we descend into <code>cider-ci/deploy</code> and proceed as mentioned mentioned above.</p> <h3 id=target-version-considerations>Target Version Considerations</h3> <p>The <a href="https://github.com/cider-ci/cider-ci_deploy">Cider-CI Deploy Project</a> <span class=text-danger> does not support downgrades.</span> Deploys are tested for successive minor versions, e.g. from <code>3.6.0</code>, to <code>3.7.0</code>, to <code>3.7.0</code>. This is the safe procedure, but skipping minor versions should work.</p> <p>Some upgrades might trigger a <a href="#clean-slate-deployment">Clean Slate Deployment</a>.</p> <h3 id=deploy-to-staging-first>Deploy to Staging First</h3> <p>It is highly recommended to deploy new versions to a staging environment which is as similar as possible to a production environment.</p> <h3 id=using-git-update-instead-of-clone>Using Git <code>update</code> instead of <code>clone</code></h3> <p>You can also just update your already cloned project. But this must be done recursively then. Updating is usually faster. But there are can be circumstances where updating recursively does not work without applying some other lower level Git commands. <span class=text-warning> It is very important that that all submodules are at the proper version as referenced from their super module. </span></p> </div> </div> </body> </html>