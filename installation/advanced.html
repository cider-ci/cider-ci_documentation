<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content='IE=edge' http-equiv=X-UA-Compatible> <meta content='width=device-width, initial-scale=1' name=viewport> <title>Cider-CI Docs</title> <link href="../assets/stylesheets/app-9123878f.css" rel=stylesheet /> <script src="../assets/javascripts/vendor-e7dce3cb.js"></script> <script src="../assets/javascripts/app-72be183c.js"></script> </head> <body id=the-cider-ci-documentation> <nav class='navbar navbar-inverse navbar-fixed-top'> <div class=container-fluid> <div class=navbar-header> <a class=navbar-brand href="../">Cider-CI <span class=semantic-version><span class=major>3</span><span class=divider>.</span><span class=minor>7</span><span class=divider>-</span><span class=pre>beta</span></span> Documentation </a></div> <form action='https://www.google.com/search' class='navbar-form navbar-left' method=get role=search> <div class=form-group> <input name=as_sitesearch type=hidden value='docs.cider-ci.info'> <input class=form-control name=as_q placeholder=Search> <input style='visibility: hidden;' type=submit value='Google Search'> </div> </form> <ul class='nav navbar-nav'> <li class=dropdown> <a class=dropdown-toggle data-toggle=dropdown href="#"><strong>Introduction</strong> <span class=caret></span> </a><ul class=dropdown-menu> <li> <a href="../introduction/">Introduction </a></li> </ul> </li> <li class=dropdown> <a class=dropdown-toggle data-toggle=dropdown href="#"><strong>Installation</strong> <span class=caret></span> </a><ul class=dropdown-menu> <li> <a href="./">Installation </a></li> <li> <a href="setup_and_deploy.html">Setup and Deploy </a></li> <li> <a href="advanced.html">Advanced Installation </a></li> </ul> </li> <li class=dropdown> <a class=dropdown-toggle data-toggle=dropdown href="#"><strong>Project Configuration</strong> <span class=caret></span> </a><ul class=dropdown-menu> <li> <a href="../project-configuration/">Project Configuration </a></li> <li> <a href="../project-configuration/configuration-file.html">Configuration File </a></li> <li> <a href="../project-configuration/jobs.html">Jobs </a></li> <li> <a href="../project-configuration/tasks.html">Tasks </a></li> <li> <a href="../project-configuration/scripts.html">Scripts </a></li> <li> <a href="../project-configuration/advanced.html">Advanced Topics </a></li> </ul> </li> <li class=dropdown> <a class=dropdown-toggle data-toggle=dropdown href="#"><strong>API</strong> <span class=caret></span> </a><ul class=dropdown-menu> <li> <a href="../api/">API </a></li> <li> <a href="../api/api_resources.html">Core API Resources </a></li> <li> <a href="../api/storage_resources.html">Storage API Resources </a></li> </ul> </li> <li class=dropdown> <a class=dropdown-toggle data-toggle=dropdown href="#"><strong>Development</strong> <span class=caret></span> </a><ul class=dropdown-menu> <li> <a href="../development/">Development </a></li> <li> <a href="../development/architecture/">Architecture </a></li> <li> <a href="../development/setup/">Setup </a></li> </ul> </li> </ul> </div> </nav> <div class=container-fluid> <div class=row> <div class='col-sm-3 col-md-2 sidebar'> <ul class='nav nav-sidebar'> <li class=''> <a class=alike href="../introduction/"><strong>Introduction</strong> </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a class=alike href="./"><strong>Installation</strong> </a></li> <ul class='nav nav-sidebar'> <li class=''> <a href="setup_and_deploy.html">Setup and Deploy </a></li> </ul> <ul class='nav nav-sidebar'> <li class=active> <a href="advanced.html">Advanced Installation </a><ul class=toc></ul> </li> </ul> </ul> <ul class='nav nav-sidebar'> <li class=''> <a class=alike href="../project-configuration/"><strong>Project Configuration</strong> </a></li> <ul class='nav nav-sidebar'> <li class=''> <a href="../project-configuration/configuration-file.html">Configuration File </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a href="../project-configuration/jobs.html">Jobs </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a href="../project-configuration/tasks.html">Tasks </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a href="../project-configuration/scripts.html">Scripts </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a href="../project-configuration/advanced.html">Advanced Topics </a></li> </ul> </ul> <ul class='nav nav-sidebar'> <li class=''> <a class=alike href="../api/"><strong>API</strong> </a></li> <ul class='nav nav-sidebar'> <li class=''> <a href="../api/api_resources.html">Core API Resources </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a href="../api/storage_resources.html">Storage API Resources </a></li> </ul> </ul> <ul class='nav nav-sidebar'> <li class=''> <a class=alike href="../development/"><strong>Development</strong> </a></li> <ul class='nav nav-sidebar'> <li class=''> <a href="../development/architecture/">Architecture </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a href="../development/setup/">Setup </a></li> </ul> </ul> </div> <div class='col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main'> <h1 id=advanced-installation>Advanced Installation</h1> <div class="alert alert-danger" role=alert> <p>This page is outdated. It will be updated for version 3.7 "Redmond".</p> </div> <h3 class=no_toc id=table-of-contents>Table of Contents</h3> <ul id=markdown-toc> <li><a id=markdown-toc-advanced-installation href="#advanced-installation">Advanced Installation</a> <ul> <li><a id=markdown-toc-installation-options href="#installation-options">Installation Options</a> <ul> <li><a id=markdown-toc-admin href="#admin">Admin</a></li> <li><a id=markdown-toc-user-interface-theme href="#user-interface-theme">User-Interface Theme</a></li> <li><a id=markdown-toc-reseting-the-master-secret href="#reseting-the-master-secret">Reseting the Master-Secret</a></li> </ul> </li> <li><a id=markdown-toc-production-environment href="#production-environment">Production Environment</a></li> <li><a id=markdown-toc-upgrading-and-redeploying href="#upgrading-and-redeploying">Upgrading and Redeploying</a></li> <li><a id=markdown-toc-executor-configuration href="#executor-configuration">Executor Configuration</a> <ul> <li><a id=markdown-toc-initial-installation-and-registration href="#initial-installation-and-registration">Initial Installation and Registration</a></li> <li><a id=markdown-toc-root-path href="#root-path">Root Path</a></li> <li><a id=markdown-toc-adding-traits href="#adding-traits">Adding Traits</a> <ul> <li><a id=markdown-toc-adding-traits-provided-by-the-cider-ci-deploy-project href="#adding-traits-provided-by-the-cider-ci-deploy-project">Adding Traits Provided by the Cider-CI Deploy Project</a></li> <li><a id=markdown-toc-adding-custom-traits href="#adding-custom-traits">Adding Custom Traits</a></li> </ul> </li> <li><a id=markdown-toc-accepted-repositories href="#accepted-repositories">Restricting the Accepted Repositories</a></li> </ul> </li> </ul> </li> </ul> <h2 id=installation-options>Installation Options</h2> <h3 id=admin>Admin</h3> <p>There needs to be at least one admin user in Cider-CI. Setting an initial admin or resetting a password at any time later can be performed as in the following example:</p> <p><code>ansible-playbook -i hosts_demo_single play_site.yml -e 'system_admin_password=secret system_admin_login=admin'</code></p> <h3 id=user-interface-theme>User-Interface Theme</h3> <p>The following themes are available: <code>bootstrap-plain</code> (this is the default), <code>bootstrap-theme</code>, <code>cider</code>, and <code>darkly</code>. Any of them can be selected as shown in the following example:</p> <p><code>ansible-playbook -i hosts_demo_single play_site.yml -e 'user_interface_theme=darkly'</code></p> <h3 id=reseting-the-master-secret>Reseting the Master-Secret</h3> <p>The <code>cider_ci_master_secret</code> can be reset at any time by re-invoking the <code>play_site</code> playbook as in the following:</p> <p><code>ansible-playbook -i hosts_demo_single play_site.yml -e 'cider_ci_master_secret=REPLACE-WITH-YOUR-NEW-SECRET'</code></p> <p>Next to resetting all internal passwords (for the database, message queue and internal communication) a new secret will invalidate all session cookies and all secrets for executors to connect immediately. <span class=text-warning> This is a security feature.</span> The user passwords itself remain valid. The executors will be configured with new passwords during the deployment.</p> <h2 id=production-environment>Production Environment</h2> <p>The procedure for installing a production environment is almost the same as for the demo environment.</p> <p>However, the parameters for the example environment are far from optimal. The <a href="https://github.com/cider-ci/cider-ci_deploy">Cider-CI Deploy Project</a> contains the hosts file <code>hosts_zhkd_ci2</code> which is more appropriate to be used as a template in this case. The directories <code>host_vars</code> and <code>group_vars</code> contain further files to be used as templates and to be customized.</p> <p>The server for a production environment should have at least 4GB of memory. A fast file system in particular with respect to <a href="https://de.wikipedia.org/wiki/Input/Output_operations_Per_Second">IOPS</a> is also recommended. Requirements for the executors depend on the use case.</p> <p>The demonstration environment installs the server and one executor on the same machine. This is convenient but usually not a good choice for a productive environment. There are security and reliability issues in particular with respect to the available traits, see <a href="#adding-traits">Adding Traits</a>.</p> <h2 id=upgrading-and-redeploying>Upgrading and Redeploying</h2> <p>Upgrading and redeploying a Cider-CI environment is similar to deploying it for the first time. We update the master project e.g. with <code>git pull</code> and all submodules with <code>git submodule update --init --recursive</code>.</p> <p>From the <code>deploy</code> directory we execute the play_site playbook in the same manner as before, e.g.</p> <p><code>ansible-playbook -i hosts_demo_single play_site.yml -e 'cider_ci_master_secret=REPLACE-WITH-YOUR-SECRET'</code></p> <p>We recommend to upgrade the minor versions in sequence without leaving any out, e.g. from <code>3.5</code>, to <code>3.6</code>, and then to <code>3.7</code>. Upgrades between major versions, e.g. from <code>2.4</code> to <code>3.0</code> may or may be not possible without complications. Please consult the release information.</p> <h2 id=executor-configuration>Executor Configuration</h2> <h3 id=initial-installation-and-registration>Initial Installation and Registration</h3> <p>Every executor must be registered with the server. This is performed automatically when installing the executor via the Ansible <code>play_site</code> playbook. To this end the executor must be registered in the Ansible hosts file. See also the <a href="./">Installation</a> page.</p> <h3 id=root-path>Root Path</h3> <p>The default root location of an installed executor on Linux is <code>/var/local/cider-ci/executor</code>. The scripts are invoked as the user <code>cider-ci_exec-user</code>.</p> <h3 id=adding-traits>Adding Traits</h3> <p>The demo installation will provide the traits <code>linux</code> and <code>bash</code> for each executor. They suffice to run the jobs of the <a href="https://github.com/cider-ci/cider-ci_demo-project-bash">Bash Demo Project for Cider-CI</a>.</p> <h4 id=adding-traits-provided-by-the-cider-ci-deploy-project>Adding Traits Provided by the Cider-CI Deploy Project</h4> <p>A set of additional traits can be automatically installed with</p> <p><code>ansible-playbook -i hosts_demo_single play_traits.yml</code></p> <div class="alert alert-warning" role=alert> <p>The traits made available are optimized for <strong>ease of use</strong> and <strong>performance</strong> but not for isolation and security. See <a href="#accepted-repositories">Restricting the Accepted Repositories</a> for isolating executions on the basis of the repository from each other.</p> </div> <h4 id=adding-custom-traits>Adding Custom Traits</h4> <p>Every executor advertises its available traits to the server. It aggregates the traits from <code>/etc/cider-ci/traits.txt</code>, and <code>./config/traits.txt</code>. The path of the latter is meant relative to the root location of the executor. The traits are separated by commas.</p> <h3 id=accepted-repositories>Restricting the Accepted Repositories</h3> <p>An executor can be configured to only accept trials for certain repositories. This is a security and trust feature. A particular executor might have the possibility to perform deploys or commit to the repository for example. When using this feature it can be ensured that only persons which have permission to push to the original repository can cause actions on this executor.</p> <p>The protection is twofold. The server is programmed to only dispatch accepted repositories to an executor. The executor will at any rate refuse to process trials for repositories it does not accept.</p> <p>Defining accepted repositories is very similar to defining traits. The file <code>/etc/cider-ci/accepted-repositories.txt</code>, and <code>./config/accepted-repositories.txt</code> take a list of comma separated repository URLs. In contrast to traits, if no accepted repositories are defined the executor will accept any repository.</p> <p class="text text-warning">Heads up: the URLs must be equal by case sensitive string comparison!</p> </div> </div> </div> </body> </html>