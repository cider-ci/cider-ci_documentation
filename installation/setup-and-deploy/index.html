<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content='IE=edge' http-equiv=X-UA-Compatible> <meta content='width=device-width, initial-scale=1' name=viewport> <title>Setup and Deployment - Cider-Ci Documentation</title> <link href="../../assets/stylesheets/app-30beb77e.css" rel=stylesheet /> <script src="../../assets/javascripts/vendor-ce938919.js"></script> <script src="../../assets/javascripts/app-72be183c.js"></script> </head> <body id=the-cider-ci-documentation> <div class=container> <nav class='navbar navbar-inverse'> <div class=container-fluid> <div class=navbar-header> <a class=navbar-brand href="../../">Cider-CI <span class=semantic-version><span class=major>3</span><span class=divider>.</span><span class=minor>10</span></span> Documentation </a></div> <form action='https://www.google.com/search' class='navbar-form navbar-left' method=get role=search> <div class=form-group> <input name=as_sitesearch type=hidden value='docs.cider-ci.info'> <input name=hl type=hidden value=en> <input class=form-control name=as_q placeholder=Search> <button class='btn btn-default' style='display: none' type=submit>Submit</button> </div> </form> <ul class='nav navbar-nav'> <li> <a href="../../introduction/">Introduction </a></li> <li> <a href="../../introduction/quick-start/">Quick-Start </a></li> <li> <a href="../../sitemap.html">Sitemap </a></li> </ul> </div> </nav> <div class=row> <div class=col-md-6> <ol class=breadcrumb> <li> <a href="../../">Home </a></li> <li> <a href="../">Installation </a></li> <li> <a href="./">Setup and Deploy </a></li> </ol> </div> <div class=col-md-6> <ol class='breadcrumb with-circle-separator'> <li> <a href="windows-preparation/">Windows Preparation </a></li> </ol> </div> </div> <div class=content> <h1 class=no_toc id=setup-and-deploy>Setup and Deploy</h1> <p>This page guides through the process of installing a Cider-CI environment.</p> <h3 class=no_toc id=table-of-contents>Table of Contents</h3> <ul id=markdown-toc> <li><a id=markdown-toc-introduction href="#introduction">Introduction</a></li> <li><a id=markdown-toc-example-environments href="#example-environments">Example Environments</a></li> <li><a id=markdown-toc-prerequisites-and-preparation href="#prerequisites-and-preparation">Prerequisites and Preparation</a> <ul> <li><a id=markdown-toc-list-of-required-software-on-the-control-machine href="#list-of-required-software-on-the-control-machine">List of Required Software on the Control Machine</a></li> </ul> </li> <li><a id=markdown-toc-project-checkout---cloning href="#project-checkout---cloning">Project Checkout - Cloning</a></li> <li><a id=markdown-toc-inventory href="#inventory">Setting Up an Inventory</a> <ul> <li><a id=markdown-toc-adjusting-the-hosts-file href="#adjusting-the-hosts-file">Adjusting the Hosts File</a></li> <li><a id=markdown-toc-the-master-secret href="#the-master-secret">The Master-Secret</a></li> <li><a id=markdown-toc-setting-custom-variables href="#setting-custom-variables">Setting Custom Variables</a> <ul> <li><a id=markdown-toc-rules-of-precedence href="#rules-of-precedence">Rules of Precedence</a></li> </ul> </li> </ul> </li> <li><a id=markdown-toc-deploy href="#deploy">Deploy</a></li> <li><a id=markdown-toc-where-to-go-from-here href="#where-to-go-from-here">Where to go from here</a></li> </ul> <h2 id=introduction>Introduction</h2> <p>Installing and maintaining a Cider-CI environment is largely an automated process thanks to the <a href="https://github.com/cider-ci/cider-ci_deploy">Cider-CI Deploy Project</a>. It supports any mixture of the <em>Linux</em> based Ubuntu 14.04 "Trusty" or Debian 8 "Jessie" operating systems for the Cider-CI server and executors. Since Cider-CI version 3.7 "Redmond" executors running on <em>Windows</em> are supported, too. It is also possible to install a Cider-CI executor manually.</p> <p>A working Cider-CI environment includes <strong>exactly one <em>Cider-CI server</em></strong> and virtually <strong>any number of <em>Cider-CI executors</em></strong>. In most most environments every component runs in its own machine. It is possible to run the server and one executor within the same machine. But we generally recommend against doing so.</p> <p>However a single machine environment can make sense for light use cases, e.g. when a single developer wants occasionally to run tests. A single machine setup is also easier to set-up and less demanding when it comes to interaction of the machines with respect to network configuration and firewalls in particular. It gets very simple if this machine also acts as the <em>control machine</em>. The control machine is purely used for deployment. It does not play a role when the Cider-CI environment is performing its daily business.</p> <h2 id=example-environments>Example Environments</h2> <div class=row> <div class=col-md-6> <p>We will use two exemplary environments for illustration. There is the <strong><em>simple</em> demo environment</strong>. One single Linux machine hosts the server, executor and also the control machine. We choose one of the two examples as a template when we will actually configure and deploy our environment. We recommend to use the simple example when installing Cider-CI for the first time.</p> <p>The <strong><em>advanced</em> demo environment</strong> consists of a server, an executor running on Linux, an executor running on Windows, and a control machine. You can still go with the advanced example even if you don't plan to use windows. We will remove the windows host from the configuration in this case later on.</p> <pre><code>  "Simple" Demo Environment: 1 Machine, only local connections
 xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

       ╔════════════════════════════════════════════════╗
       ║                                                ║
       ║                Control Machine                 ║
       ║                                                ║
       ║                Cider-CI Server                 ║
       ║                                                ║
       ║            Cider-CI Linux Executor             ║
       ║                                                ║
       ╚════════════════════════════════════════════════╝
</code></pre> </div> <div class=col-md-6> <pre><code>  "Advanced" Demo Environment: 3 CI Machines + Control Machine
 xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

 ┏━━━━━━━━━━━━━━━━━━┓              ╔═══════════════════════════╗
 ┃                  ┃              ║                           ║
 ┃                  ┣──────SSH─────▶  Cider-CI Linux Executor  ║
 ┃                  ┃              ║                           ║
 ┃                  ┃              ╚══▲═══════════════════╦════╝
 ┃                  ┃                 │                   │
 ┃                  ┃                 │                   │
 ┃                  ┃              HTTPS                HTTPS
 ┃                  ┃              (push)           (ping, sync,
 ┃                  ┃                 │             config, pull)
 ┃                  ┃                 │                   │
 ┃                  ┃              ╔══╩═══════════════════▼════╗
 ┃                  ┃              ║                           ║
 ┃ Control Machine  ┃              ║                           ║
 ┃                  ┣──────SSH─────▶      Cider-CI Server      ║
 ┃      Ansible     ┃              ║                           ║
 ┃                  ┃              ║                           ║
 ┃                  ┃              ╚══╦═══════════════════▲════╝
 ┃                  ┃                 │                   │
 ┃                  ┃                 │                   │
 ┃                  ┃              HTTPS                HTTPS
 ┃                  ┃              (push)            (ping, sync,
 ┃                  ┃                 │             config, pull)
 ┃                  ┃                 │                   │
 ┃                  ┃              ╔══▼═══════════════════╩════╗
 ┃                  ┃              ║                           ║
 ┃                  ┣────WinRM─────▶ Cider-CI Windows Executor ║
 ┃                  ┃              ║                           ║
 ┗━━━━━━━━━━━━━━━━━━┛              ╚═══════════════════════════╝
</code></pre> </div> </div> <h2 id=prerequisites-and-preparation>Prerequisites and Preparation</h2> <p>The <a href="https://github.com/cider-ci/cider-ci_deploy">Cider-CI Deploy Project</a> relies heavily on Ansible which must be present on the <em>control</em> machine. The control machine orchestrates deployment and updates.</p> <p>See the <a href="http://docs.ansible.com/intro_installation.html">Install</a> page of the Ansible Documentation to install Ansible. Alternatively you might want to have look at the <a href="https://github.com/cider-ci/cider-ci_deploy/blob/master/bin/quick-install.sh#L37-L38">two Ansible related lines of the quick-install script</a> to quickly install Ansible without hassle. We use a fairly recent version (≥ 1.9 at the time of writing) of Ansible. The operating system on the controller is not relevant. We use <em>Mac OS X</em> and various <em>Linux</em> variants.</p> <p>It is possible to run use a machine which is part of the Cider-CI environment as a control machine (as long it is not a Windows machine). The simplest Cider-CI environment combines the server, executor and control machine in one single instance. This is actually what happens when you follow the [Quick Start] guide which is essentially performed by the already mentioned <a href="https://github.com/cider-ci/cider-ci_deploy/blob/master/bin/quick-install.sh">quick-install script</a>.</p> <p>Preparing the Linux machines is little effort. The working account on the <strong>control machine</strong> must have <strong>ssh access to all Linux target machines</strong>. A setup with SSH keys and without passwords to the root account is the most straight forward configuration.</p> <p>A Windows system needs more manual preparation. Read the <a href="/installation/setup-and-deploy/windows-preparation">Windows Preparation</a> guide for more information if you are going to deploy one or more executors on Windows.</p> <p>Every executor needs during installation and for operation access via HTTPS to the server. The server dispatches via HTTPS during normal operation. There is also a <em>pull mode only</em>. See the <a href="../../howtos/executors/pull-mode/">Pull Mode Howto</a>.</p> <p><strong>Make sure that all of the depicted connections are possible and actually do work in your environment.</strong></p> <h3 id=list-of-required-software-on-the-control-machine>List of Required Software on the Control Machine</h3> <ul> <li>Ansible</li> <li>Git</li> <li>OpenSSL</li> </ul> <h2 id=project-checkout---cloning>Project Checkout - Cloning</h2> <p>We login to our control machine and clone the complete Cider-CI project including all submodules. The <code>master</code> branch contains the most recent stable version and is usually a good choice.</p> <p><code>git clone -b master https://github.com/cider-ci/cider-ci.git --recursive</code></p> <p>We descend into the deploy directory/project.</p> <p><code>cd cider-ci/deploy</code></p> <h2 id=inventory>Setting Up an Inventory</h2> <div class=row> <div class=col-md-6> <p>There is an inventory directory which contains two demo environments. See the tree structure in the provided code snippet.</p> <p>The main inventory files are <a href="https://github.com/cider-ci/cider-ci_deploy/blob/master/inventories/demo/simple/hosts"><code>inventories/demo/simple/hosts</code></a> and <a href="https://github.com/cider-ci/cider-ci_deploy/blob/master/inventories/demo/advanced/hosts"><code>inventories/demo/advanced/hosts</code></a> respectively. They define the machines (or hosts) as the name of the file suggests. The other files are group or machine related configuration files. We <strong>copy either of the two inventories</strong> to a place outside the repository.</p> <p><code>cp -rv inventories/demo/simple PATH-TO-OUR-INVENTORY</code></p> <p>or</p> <p><code>cp -rv inventories/demo/advanced PATH-TO-OUR-INVENTORY</code></p> <p>We will modify our freshly created inventory in the next sections. The contents of the deploy folder remain untouched.</p> </div> <div class=col-md-6> <pre><code>▾ inventories/
  ▾ demo/
    ▾ advanced/
      ▾ group_vars/
          cider-ci-executors-linux.yml
          secrets.yml
      ▾ host_vars/
          windows-executor.yml
        hosts
    ▾ simple/
      ▾ host_vars/
          demo-machine.yml
        hosts
</code></pre> </div> </div> <div class="alert alert-info"> <p>It was recommended to fork the <a href="https://github.com/cider-ci/cider-ci_deploy">Cider-CI Deploy Project</a> in earlier revisions of this guide to perform changes within. The structure of the project has been rewritten as of version 3.7.</p> </div> <h3 id=adjusting-the-hosts-file>Adjusting the Hosts File</h3> <div class=row> <div class=col-md-6> <p>The <code>hosts</code> file of the inventory declare the involved machines and groups them. It can also contain host specific variables but it is recommended to keep those in a host specific file located in the <code>host_vars</code> directory relative to the <code>hosts</code> file. See the directory structure of the previous section for an example.</p> <p>The simple demo uses the local connection <code>127.0.0.1</code>. We don't need to change anything in this case.</p> </div> <div class=col-md-6> <pre><code># Cider-CI hosts for the simple demo

[simple-demo-machines]
demo-machine ansible_ssh_host=127.0.0.1 ansible_ssh_user=root

[cider-ci-server]
demo-machine

[cider-ci-executors-linux]
demo-machine
</code></pre> </div> </div> <div class=row> <div class=col-md-6> <p>We need tho <strong>adjust the IP addresses</strong> for the advanced demo . We <strong>either delete the <code>windows-executor</code></strong> and all references in the file or we <strong>adjust the IP address</strong> and the <strong>connection parameters</strong> for it. See the <a href="windows-preparation/">Windows Preparation Guide</a> and in particular the <a href="windows-preparation/#inventory">inventory</a> section.</p> </div> <div class=col-md-6> <pre><code># Cider-CI hosts for the advanced demo

[advanced-demo-machines]
server ansible_ssh_host=192.168.0.10 ansible_ssh_user=root
linux-executor ansible_ssh_host=192.168.0.11 ansible_ssh_user=root
windows-executor ansible_ssh_host=192.168.0.60

[cider-ci-server]
server

[cider-ci-executors-linux]
linux-executor

[cider-ci-executors-windows]
windows-executor
</code></pre> </div> </div> <h3 id=the-master-secret>The Master-Secret</h3> <div class=row> <div class=col-md-6> <p>Every Cider-CI Environment contains several secrets, there is for example one for the database, one for signing session objects and so on. By default all these secrets are derived from one master-secret. Each of them can defined individually.</p> <p>The default master-secret is derived from several system properties. Its security depends on the setup of your system. <strong>We highly recommend to override the master-secret for productive system</strong>.</p> <p>Uncomment and adjust the value of the <code>cider_ci_master_secret</code> in <code>group_vars/demo-machines.yml</code>.</p> </div> <div class=col-md-6> <pre><code># in group_vars/demo-machines.yml
cider_ci_master_secret: A-VERY-LONG-SECRET-STRING
</code></pre> </div> </div> <h3 id=setting-custom-variables>Setting Custom Variables</h3> <p>The <code>cider_ci_master_secret</code> is one example of many variables which have default values but can be overridden. These variables are defined in the file <a href="https://github.com/cider-ci/cider-ci_deploy/blob/master/group_vars/all.yml">group_vars/all.yml</a> (relative to the top level deploy project). We recommend to have a look into the file to see what variables are available. The secrets section towards the end is in particular relevant with respect to redefining the <code>cider_ci_master_secret</code>.</p> <h4 id=rules-of-precedence>Rules of Precedence</h4> <p>The following explains slightly simplified rules for variable precedence. The precise rules are explained in the <a href="http://docs.ansible.com/ansible/playbooks_variables.html#variable-precedence-where-should-i-put-a-variable">Variable Precedence Documentation of Ansible</a>. The <a href="https://github.com/cider-ci/cider-ci_deploy/blob/master/group_vars/all.yml">group_vars/all.yml</a> file in the <a href="https://github.com/cider-ci/cider-ci_deploy">Cider-CI Deploy Project</a> is the first one consulted for variable definitions. Then come the <code>group_vars</code> in the individual inventory (relative to the <code>hosts</code> file), then the <code>host_vars</code>. Finally command line options for <code>ansible</code> or <code>ansible-playbook</code> will override any variable which were set before. We will make use of this when performing a deploy in the next section.</p> <h2 id=deploy>Deploy</h2> <p>We will now deploy our configured Cider-CI environment:</p> <p><code>ANSIBLE_LOAD_CALLBACK_PLUGINS=1 DEPLOY_ROOT_DIR=`pwd` ansible-playbook -i PATH-TO-OUR-INVENTORY play_site.yml -e "admin_password=SOME-SECRET"</code></p> <p>The deploy can take a while. We can expect at least 30 minutes for an initial deploy. It can take much longer depending on the power of the machines and moreover the on the speed of the Internet connection.</p> <p>The deploy depends on a lot of downloads from the Internet. If one download fails the deploy will abort. It is possible to invoke the command at any time later again.</p> <h2 id=where-to-go-from-here>Where to go from here</h2> <p>Add your own project to your installation and configure it which is covered in <a href="/project-configuration/">Project Configuration</a>. You will probably need a few more traits on top of the default ones. Read about adding traits to your executor in <a href="/installation/adding-traits">Adding Traits</a>. If you want learn about how to set up an production like Cider-CI environment read <a href="">Advanced Installation</a>.</p> </div> </div> </body> </html>