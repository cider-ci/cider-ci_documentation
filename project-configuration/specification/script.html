<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content='IE=edge' http-equiv=X-UA-Compatible> <meta content='width=device-width, initial-scale=1' name=viewport> <title>The Script Specification - Cider-Ci Documentation</title> <link href="../../assets/stylesheets/app-b5c8715a.css" rel=stylesheet /> <script src="../../assets/javascripts/vendor-1e8b60d8.js"></script> <script src="../../assets/javascripts/app-871935e9.js"></script> </head> <body id=the-cider-ci-documentation> <div class=container> <nav class='navbar navbar-inverse'> <div class=container-fluid> <div class=navbar-header> <a class=navbar-brand href="../../">Cider-CI Documentation </a></div> <form action='/search.html' class='navbar-form navbar-left' id=search method=get role=search> <div class=form-group> <input class=form-control id=search-term name=term placeholder=Search> <button class='btn btn-default' style='display: none' type=submit>Submit</button> </div> </form> <ul class='nav navbar-nav'> <li> <a href="../../introduction/">Introduction </a></li> <li> <a href="../../introduction/quick-start/">Quick-Start </a></li> <li> <a href="../../sitemap.html">Sitemap </a></li> </ul> </div> </nav> <div class=row> <div class=col-md-6> <ol class=breadcrumb> <li> <a href="../../">Home </a></li> <li> <a href="../">Project Configuration </a></li> <li> <a href="./">Specification </a></li> <li> <a href="script.html">Script </a></li> </ol> </div> <div class=col-md-6> </div> </div> <div class=content> <h1 id=the-script-specification>The Script Specification</h1> <h2 id=overview>Overview</h2> <table class="table table-striped"> <thead> <tr> <th>Key/Property</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td><code>body</code></td> <td>String, the actual script being executed.</td> </tr> <tr> <td><code>description</code></td> <td>String.</td> </tr> <tr> <td><code>environment_variables</code></td> <td>Map of strings. Subject to [inheritance].</td> </tr> <tr> <td><code>exclusive_executor_resource</code></td> <td>String, see <a href="#exclusive_executor_resource"><code>exclusive_executor_resource</code> on this page</a>.</td> </tr> <tr> <td><code>ignore_abort</code></td> <td>Boolean, defaults to <code>false</code>. The script will not be skipped or aborted if set to <code>true</code>.</td> </tr> <tr> <td><code>ignore_state</code></td> <td>Boolean, defaults to <code>false</code>. The state of this will not be taken into account for the aggregate state of the trial.</td> </tr> <tr> <td><code>key</code></td> <td>String, defaults to the key in the scripts map. Uses to reference this script in <code>start_when</code> for example.</td> </tr> <tr> <td><code>name</code></td> <td>String.</td> </tr> <tr> <td><code>start_when</code></td> <td>Map of maps, see <a href="#start_when"><code>start_when</code> and <code>terminate_when</code> on this page</a>.</td> </tr> <tr> <td><code>template_environment_variables</code></td> <td>Boolean, defaults to <code>true</code>.</td> </tr> <tr> <td><code>terminate_when</code></td> <td>Map of maps. Opposite of <code>start_when</code>, each value specifies when to abort a script prematurely.</td> </tr> <tr> <td><code>timeout</code></td> <td>String, representing a <a href="other/duration.html">duration</a>, defaults to <code>3 minutes</code>. Determines when a script will be forcefully terminated.</td> </tr> </tbody> </table> <h2 id=exclusive_executor_resource>The <code>exclusive_executor_resource</code> Property</h2> <div class=row> <div class=col-md-6> <p>The <code>exclusive_executor_resource</code> <strong>prevents</strong> two (or more) scripts with the same value to be <strong>executed in parallel</strong> on the <strong>same executor</strong>. The value is <strong>honored across scripts belonging to different trials/tasks</strong>, which is the prevalent use case.</p> <p>The value is a string which can be <strong>templated</strong>. See also the <a href="other/templating.html">templating</a> page. Templating is always enabled: <code>{{</code> and <code>}}</code> is to be avoided if no templating is intended.</p> <p>If a script with a certain value is currently executing and an other script with the same value becomes eligible for being started, i.e. it fulfills the conditions given by <code>start_when</code>, its state will move from <code>pending</code> to <code>waiting</code>. It will be started when the "resource becomes available".</p> <p>There are <strong>no guarantees</strong> with respect to the <strong>order</strong> if there are multiple scripts with the same value in <code>waiting</code> state.</p> <p><strong>Deadlock situations are impossible</strong> because every script has only one <code>exclusive_executor_resource</code> property.</p> </div> <div class=col-md-6> <div class="language-yaml highlighter-coderay"><div class=CodeRay> <div class=code><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#606">environment_variables</span>:
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>  <span style="color:#606">RUBY_VERSION</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">2.2.4</span></span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span><span style="color:#606">scripts</span>:
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>  <span style="color:#606">bundle</span>:
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>    <span style="color:#777"># never run `bundle install` in parallel,</span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>    <span style="color:#777"># it is likely to break your ruby installation</span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>    <span style="color:#606">exclusive_executor_resource</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ruby_{{RUBY_VERSION}}</span><span style="color:#710">&quot;</span></span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>    <span style="color:#606">bundle</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">|</span><span style="color:#D20"></span></span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span><span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">      set -eux</span></span>
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span><span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">      rbenv shell $RUBY_VERSION</span></span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span><span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">      bundle install</span></span>
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>
</pre></div> </div> </div> </div> </div> <h2 id=start_when>The <code>start_when</code> and <code>terminate_when</code> Properties</h2> <div class=row> <div class=col-md-6> <p>The <code>starte_when</code> property is used to define dependencies between scripts belonging to the same trial. The article article <a href="http://cider-ci.info/articles/testing-services/index.html">Testing Services</a> has further information about the ratio of this feature.</p> <p>The <code>terminate_when</code> property defines conditions to specify premature termination of a script. It is not as useful as <code>start_when</code> property. It is mostly useful to achieve faster termination of a running script when some other script fails.</p> <p>Both properties use a map of maps to specify a collection of dependencies. The keys can be freely chosen, for example to describe the dependency. The items are combined with logical conjunction: a script will be started if and only if <strong>all dependencies are satisfied</strong>.</p> <table class="table table-striped"> <thead> <tr> <th>Key/Property</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td><code>script_key</code></td> <td>String, the key of the script to reference.</td> </tr> <tr> <td><code>states</code></td> <td>Array of states out of: <code>aborted</code>, <code>defective</code>, <code>executing</code>, <code>failed</code>, <code>passed</code>, <code>pending</code>, <code>skipped</code>, <code>waiting</code>.</td> </tr> </tbody> </table> </div> <div class=col-md-6> <div class="language-yaml highlighter-coderay"><div class=CodeRay> <div class=code><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#606">scripts</span>:
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>  <span style="color:#606">prepare</span>:
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>    <span style="color:#606">body</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">do some preparing</span></span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>  <span style="color:#606">run-service</span>:
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>    <span style="color:#606">body</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">run some service and keep it running</span></span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>    <span style="color:#606">terminate_when</span>:
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>      <span style="color:#606"><span style="color:#404">'</span><span>test is in terminal state</span><span style="color:#404">'</span></span>:
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>        <span style="color:#606">script_key</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">test</span></span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>        <span style="color:#606">states</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">['aborted', 'deffective', 'failed', 'passed', 'skipped']</span></span>
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>    <span style="color:#606">ignote_state</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>  <span style="color:#606">test</span>:
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>    <span style="color:#606">body</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">test</span></span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>    <span style="color:#606">start_when</span>:
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>      <span style="color:#606"><span style="color:#404">'</span><span>prepared</span><span style="color:#404">'</span></span>:
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>        <span style="color:#606">script_key</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">prepare</span></span>
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>        <span style="color:#606">states</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">[ &quot;passed&quot; ]</span></span>
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>      <span style="color:#606"><span style="color:#404">'</span><span>service is running</span><span style="color:#404">'</span></span>:
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>        <span style="color:#606">script_key</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">run-service</span></span>
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>        <span style="color:#606">states</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">[ &quot;executing&quot;]</span></span>
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>  <span style="color:#606">cleanup</span>:
<span class="line-numbers"><a href="#n21" name="n21">21</a></span>    <span style="color:#606">body</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">do some cleanup</span></span>
<span class="line-numbers"><a href="#n22" name="n22">22</a></span>    <span style="color:#606">start_when</span>:
<span class="line-numbers"><a href="#n23" name="n23">23</a></span>      <span style="color:#606"><span style="color:#404">'</span><span>start when test is in terminal state</span><span style="color:#404">'</span></span>:
<span class="line-numbers"><a href="#n24" name="n24">24</a></span>        <span style="color:#606">script_key</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">test</span></span>
<span class="line-numbers"><a href="#n25" name="n25">25</a></span>        <span style="color:#606">states</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">['aborted', 'deffective', 'failed', 'passed', 'skipped']</span></span>
<span class="line-numbers"><a href="#n26" name="n26">26</a></span>
</pre></div> </div> </div> </div> </div> </div> <div class=row> <div class=col-md-12> <footer> <div class=pull-right> Cider-CI <span class=semantic-version><span class=major>4</span><span class=divider>.</span><span class=minor>1</span><span class=patch-pre-build><span class=divider>.</span><span class=patch>0</span><span class=divider>-</span><span class=pre>0.0</span></span></span> Documentation 2016-07-24 © Thomas Schank and contributors </div> </footer> </div> </div> </div> </body> </html>