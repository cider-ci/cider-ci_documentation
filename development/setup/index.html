<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content='IE=edge' http-equiv=X-UA-Compatible> <meta content='width=device-width, initial-scale=1' name=viewport> <title>Cider-Ci Docs - Development Setup</title> <link href="../../assets/stylesheets/app-9123878f.css" rel=stylesheet /> <script src="../../assets/javascripts/vendor-e7dce3cb.js"></script> <script src="../../assets/javascripts/app-72be183c.js"></script> </head> <body id=the-cider-ci-documentation> <nav class='navbar navbar-inverse navbar-fixed-top'> <div class=container-fluid> <div class=navbar-header> <a class=navbar-brand href="../../">Cider-CI <span class=semantic-version><span class=major>3</span><span class=divider>.</span><span class=minor>2</span></span> Documentation </a></div> <form action='https://www.google.com/search' class='navbar-form navbar-left' method=get role=search> <div class=form-group> <input name=as_sitesearch type=hidden value='docs.cider-ci.info'> <input class=form-control name=as_q placeholder=Search> <input style='visibility: hidden;' type=submit value='Google Search'> </div> </form> <ul class='nav navbar-nav'> <li class=dropdown> <a class=dropdown-toggle data-toggle=dropdown href="#"><strong>Introduction</strong> <span class=caret></span> </a><ul class=dropdown-menu> <li> <a href="../../introduction/">Introduction </a></li> </ul> </li> <li class=dropdown> <a class=dropdown-toggle data-toggle=dropdown href="#"><strong>Installation</strong> <span class=caret></span> </a><ul class=dropdown-menu> <li> <a href="../../installation/">Installation </a></li> <li> <a href="../../installation/executor-configuration.html">Executor Configuration </a></li> </ul> </li> <li class=dropdown> <a class=dropdown-toggle data-toggle=dropdown href="#"><strong>Project Configuration</strong> <span class=caret></span> </a><ul class=dropdown-menu> <li> <a href="../../project-configuration/">Project Configuration </a></li> <li> <a href="../../project-configuration/dotfile.html">Dotfile </a></li> <li> <a href="../../project-configuration/jobs.html">Jobs </a></li> <li> <a href="../../project-configuration/tasks.html">Tasks </a></li> <li> <a href="../../project-configuration/scripts.html">Scripts </a></li> <li> <a href="../../project-configuration/advanced.html">Advanced Topics </a></li> </ul> </li> <li class=dropdown> <a class=dropdown-toggle data-toggle=dropdown href="#"><strong>API</strong> <span class=caret></span> </a><ul class=dropdown-menu> <li> <a href="../../api/">API </a></li> <li> <a href="../../api/api_resources.html">Core API Resources </a></li> <li> <a href="../../api/storage_resources.html">Storage API Resources </a></li> </ul> </li> <li class=dropdown> <a class=dropdown-toggle data-toggle=dropdown href="#"><strong>Development</strong> <span class=caret></span> </a><ul class=dropdown-menu> <li> <a href="../architecture/">Architecture </a></li> <li> <a href="./">Setup </a></li> </ul> </li> </ul> </div> </nav> <div class=container-fluid> <div class=row> <div class='col-sm-3 col-md-2 sidebar'> <ul class='nav nav-sidebar'> <li class=''> <a class=alike href="../../introduction/"><strong>Introduction</strong> </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a class=alike href="../../installation/"><strong>Installation</strong> </a></li> <ul class='nav nav-sidebar'> <li class=''> <a href="../../installation/executor-configuration.html">Executor Configuration </a></li> </ul> </ul> <ul class='nav nav-sidebar'> <li class=''> <a class=alike href="../../project-configuration/"><strong>Project Configuration</strong> </a></li> <ul class='nav nav-sidebar'> <li class=''> <a href="../../project-configuration/dotfile.html">Dotfile </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a href="../../project-configuration/jobs.html">Jobs </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a href="../../project-configuration/tasks.html">Tasks </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a href="../../project-configuration/scripts.html">Scripts </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a href="../../project-configuration/advanced.html">Advanced Topics </a></li> </ul> </ul> <ul class='nav nav-sidebar'> <li class=''> <a class=alike href="../../api/"><strong>API</strong> </a></li> <ul class='nav nav-sidebar'> <li class=''> <a href="../../api/api_resources.html">Core API Resources </a></li> </ul> <ul class='nav nav-sidebar'> <li class=''> <a href="../../api/storage_resources.html">Storage API Resources </a></li> </ul> </ul> <ul class='nav nav-sidebar'> <li class=''> <span class=alike> <strong>Development</strong> </span> </li> <ul class='nav nav-sidebar'> <li class=''> <a href="../architecture/">Architecture </a></li> </ul> <ul class='nav nav-sidebar'> <li class=active> <a href="./">Setup </a><ul class=toc></ul> </li> </ul> </ul> </div> <div class='col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main'> <h1 class=no_toc id=setting-up-a-cider-ci-development-environment>Setting up a Cider-CI Development Environment</h1> <ul id=markdown-toc> <li><a id=markdown-toc-prerequisites href="#prerequisites">Prerequisites</a></li> <li><a id=markdown-toc-project-checkout href="#project-checkout">Project Checkout</a></li> <li><a id=markdown-toc-message-queues---rabbitmq href="#message-queues---rabbitmq">Message-Queues - RabbitMQ</a></li> <li><a id=markdown-toc-database---postgresql href="#database---postgresql">Database - PostgreSQL</a></li> <li><a id=markdown-toc-reverse-proxy href="#reverse-proxy">Reverse Proxy</a></li> <li><a id=markdown-toc-user-interface-service href="#user-interface-service">User-Interface Service</a></li> <li><a id=markdown-toc-clojure-services href="#clojure-services">Clojure Services</a></li> <li><a id=markdown-toc-executor href="#executor">Executor</a> <ul> <li><a id=markdown-toc-status-of-the-executor-service href="#status-of-the-executor-service">Status of the Executor-Service</a></li> </ul> </li> <li><a id=markdown-toc-running-a-job href="#running-a-job">Running a Job</a></li> </ul> <h2 id=prerequisites>Prerequisites</h2> <div class=row> <div class=col-md-6> <ul> <li>PostgreSQL version ≥ 9.4 (≤ 9.3 will not suffice!)</li> <li>RabbitMQ version ≥ 3.0 (≥ 3.3 recommended)</li> <li>JDK 7 or later</li> <li><a href="//leiningen.org/">Leiningen</a> version ≥ 2.0 (≥ 2.5 recommended)</li> <li><a href="https://www.ruby-lang.org/">Ruby</a> ≥ 1.9 (≥ 2.1 recommended) with <a href="//bundler.io/">Bundler</a></li> <li><a href="https://nodejs.org/">Nodejs</a> with npm</li> </ul> <p>The environment will by default require the following ports (in addition to the ones used by PostgreSQL and RabbitMQ):</p> <ul> <li>8880 ‥ 8889</li> <li>7880 ‥ 7889</li> <li>8443</li> </ul> </div> </div> <h2 id=project-checkout>Project Checkout</h2> <div class=row> <div class=col-md-6> <p>A running instance of Cider-CI is composed of several services. See the <a href="/development/architecture/">Architecture</a> page for an overview.</p> <p>The source code for each service is a git submodule of the main <a href="https://github.com/cider-ci/cider-ci">Cider-CI</a> project.</p> </div> <div class=col-md-6> <div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1</pre></td><td class=code><pre>git clone --recursive https://github.com/cider-ci/cider-ci.git
</pre></td></tr></tbody></table> </div> </div> </div> <h2 id=message-queues---rabbitmq>Message-Queues - RabbitMQ</h2> <div class=row> <div class=col-md-6> <p>We set up a vhost, a user and permit the user.</p> <p>The RabbitMQ <a href="https://www.rabbitmq.com/management.html">Management Plugin</a> allows us to verify the connection status via the Cider-CI User-Interface.</p> </div> <div class=col-md-6> <div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1
2
3
4
5
6
7</pre></td><td class=code><pre>rabbitmqctl add_user cider-ci secret
rabbitmqctl add_vhost cider-ci
rabbitmqctl set_permissions -p cider-ci cider-ci ".*"  ".*" ".*"
rabbitmqctl -p cider-ci list_permissions

rabbitmq-plugins enable rabbitmq_management
rabbitmqctl set_user_tags cider-ci administrator
</pre></td></tr></tbody></table> </div> </div> </div> <h2 id=database---postgresql>Database - PostgreSQL</h2> <div class=row> <div class=col-md-6> <p>We set up the <code>cider-ci</code> role within <a href="//www.postgresql.org/docs/current/static/app-psql.html">psql</a>:</p> </div> <div class=col-md-6> <div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1</pre></td><td class=code><pre>CREATE ROLE "cider-ci" PASSWORD 'secret' createdb superuser login;
</pre></td></tr></tbody></table> </div> </div> </div> <div class=row> <div class=col-md-6> <p>We change into the directory of the Cider-CI User-Interface, configure, create the database and load some initial data to work with.</p> </div> <div class=col-md-6> <div class="highlight shell"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1
2
3
4</pre></td><td class=code><pre>cp config/database_dev.yml config/database.yml
bundle
bundle <span class="nb">exec </span>rake db:create db:migrate
bundle <span class="nb">exec </span>rake db:seed
</pre></td></tr></tbody></table> </div> </div> </div> <h2 id=reverse-proxy>Reverse Proxy</h2> <div class=row> <div class=col-md-6> <p>A deployed environment of Cider-CI uses the Apache HTTP server as a reverse proxy. A development environment uses the <a href="https://github.com/cider-ci/cider-ci_reverse-proxy">Cider-CI Reverse Proxy</a> instead. The code is located in the <code>cider-ci/reverse-proxy</code> dictionary and the service can be started by running <code>./bin/run</code> from within that directory.</p> </div> <div class=col-md-6> <div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1
2</pre></td><td class=code><pre>cd reverse-proxy
./bin/run
</pre></td></tr></tbody></table> </div> </div> </div> <h2 id=user-interface-service>User-Interface Service</h2> <p>The <a href="https://github.com/cider-ci/cider-ci_user-interface">Cider-CI User-Interface</a> is a Ruby on Rails application.</p> <div class=row> <div class=col-md-6> <p>The Javascript dependencies are managed via npm and we need to build them.</p> </div> <div class=col-md-6> <div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1</pre></td><td class=code><pre>npm run build
</pre></td></tr></tbody></table> </div> </div> </div> <div class=row> <div class=col-md-6> <p>We start the web-server from within the directory of the Cider-CI User-Interface.</p> </div> <div class=col-md-6> <div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1</pre></td><td class=code><pre>bundle exec rails s -p 8880
</pre></td></tr></tbody></table> </div> </div> </div> <div class=row> <div class=col-md-6> <p>We visit the url <a href="//localhost:8888/cider-ci/ui/public">http://localhost:8888/cider-ci/ui/public</a> in a browser and should see a similar page as shown.</p> </div> <div class=col-md-6> <p><a href="welcome-page.png"><img alt=Welcome-Page class=preview src="welcome-page.png"/></a></p> </div> </div> <div class=row> <div class=col-md-6> <p>We sign in with the user <code>admin</code> and password <code>secret</code> and follow the links <code>Administration</code> → <code>Service stati</code>. <a href="//localhost:8888/cider-ci/ui/admin/status">http://localhost:8888/cider-ci/ui/admin/status</a> reveals that the message queue is running but non of the services are:</p> </div> <div class=col-md-6> <p><a href="services-offline.png"><img alt=Services-Offline class=preview src="services-offline.png"/></a></p> </div> </div> <h2 id=clojure-services>Clojure Services</h2> <div class=row> <div class=col-md-6> <p>All of the remain services <a href="https://github.com/cider-ci/cider-ci_api">Cider-CI API</a>, <a href="https://github.com/cider-ci/cider-ci_builder">Cider-CI Builder</a>, <a href="https://github.com/cider-ci/cider-ci_dispatcher">Cider-CI Dispatcher</a>, <a href="https://github.com/cider-ci/cider-ci_executor">Cider-CI Executor</a>, <a href="https://github.com/cider-ci/cider-ci_repository">Cider-CI Repository</a>, and <a href="https://github.com/cider-ci/cider-ci_storage">Cider-CI Storage</a> are written in clojure. Each of them comes with a <code>./bin/run</code> script which will start a headless server.</p> <p>We can alternatively start a REPL from inside each directory and then start the service therein with <code>(-main)</code>.</p> </div> <div class=col-md-6> <div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1
2</pre></td><td class=code><pre>cd SERVICE_DIRECTORY
./bin/run
</pre></td></tr></tbody></table> </div> <p>or</p> <div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1
2
3</pre></td><td class=code><pre>cd SERVICE_DIRECTORY
lein repl
(-main)
</pre></td></tr></tbody></table> </div> </div> </div> <div class="alert alert-warning"> <p>The services use relative paths to access files. It is crucial that they are started from within their own top level directory!</p> </div> <p>All of the services should now be listed <code>OK</code> at <a href="//localhost:8888/cider-ci/ui/admin/status">http://localhost:8888/cider-ci/ui/admin/status</a>.</p> <h2 id=executor>Executor</h2> <h3 id=status-of-the-executor-service>Status of the Executor-Service</h3> <div class=row> <div class=col-md-6> <p>The Executor-Services are listed on the <code>Administration</code> → <code>Executors</code> page <a href="//localhost:8888/cider-ci/ui/admin/executors">http://localhost:8888/cider-ci/ui/admin/executors</a>. There is only one configured in the default data set. It matches the parameters of the default development executor and hence it should be up and running.</p> <p>Note: other parameters, like the <code>traits</code> e.g., are taken from the default setup when an executor is installed via the <a href="https://github.com/cider-ci/cider-ci_ansible-setup">Cider-CI Ansible Setup</a> . They might not match the given development environment.</p> </div> <div class=col-md-6> <p><a href="executors.png"><img alt=Executors class=preview src="executors.png"/></a></p> </div> </div> <h2 id=running-a-job>Running a Job</h2> <div class=row> <div class=col-md-6> <p>Running a job is the final test for our environment. The dataset comes with a predefined repository. It features fairly simple examples. Some of the defined tasks purposely fail with a certain probability. Hence, a failed job can be a positive outcome of this test. Note, that a particular job can only exist once for a given tree_id or commit. However, existing jobs can be deleted.</p> </div> <div class=col-md-6> <p><a href="job.png"><img alt=Job class=preview src="job.png"/></a></p> </div> </div> </div> </div> </div> </body> </html>